---
phase: 04-file-upload-system
plan: 03
type: execute
depends_on:
  - phase: 04-file-upload-system
    plan: 01
files_modified: []
---

<objective>
Add psychologist credential document uploads with secure storage and display in the psychologist profile/settings area.

Purpose: Allow psychologists to submit licenses/credentials as PDF or image files for verification.

Output: Psychologist can upload and view credential documents; URLs/keys stored in database.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/(dashboard)/psychologist/dashboard/profile/page.tsx
@src/app/api/user/me/route.ts
@src/app/api/uploadthing/core.ts

**Current state:**
- Psychologist profile page exists but has no document upload
- Uploadthing endpoint for credential documents will exist (from 04-01)
- Psychologist model will include credential document URL + key

**Requirements:**
- Only psychologists can upload
- Accept PDF + image only
- Store URL/key in database
- Display uploaded doc status in UI
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update /api/user/me to return credential doc fields</name>
  <files>src/app/api/user/me/route.ts</files>
  <action>
Include `credentialDocumentUrl` and `credentialDocumentKey` in the psychologist select fields for GET and PATCH responses.
  </action>
  <verify>
Response JSON includes credential document fields for psychologists.
  </verify>
  <done>
- /api/user/me returns credential document metadata
  </done>
</task>

<task type="auto">
  <name>Task 2: Add credential upload UI to psychologist profile</name>
  <files>src/app/(dashboard)/psychologist/dashboard/profile/page.tsx</files>
  <action>
Add a “Credential Documents” section with:
- Uploadthing `UploadButton` (endpoint: `credentialDocument`)
- Current document status (uploaded/not uploaded)
- Link to view document (opens in new tab)

On upload completion, update local state to show document URL.
  </action>
  <verify>
- Psychologist profile shows document upload section
- Uploading a document updates the UI
  </verify>
  <done>
- Credential document upload works end-to-end
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] /api/user/me returns credential doc fields
- [ ] Psychologist profile includes upload UI
- [ ] Document upload persists to DB
</verification>

<success_criteria>
- Psychologists can upload credentials
- Document URL and key stored in DB
- UI shows upload status
</success_criteria>

<output>
After completion, create `.planning/phases/04-file-upload-system/04-03-SUMMARY.md`
</output>
