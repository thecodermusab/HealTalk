---
phase: 06-video-consultations
plan: 01
type: execute
depends_on:
  - phase: 05-email-notifications
    plan: 04
files_modified: []
---

<objective>
Set up Agora SDK and server-side token generation for secure video sessions.

Purpose: Provide authenticated, time-limited Agora tokens for 1:1 calls.

Output: Agora token API route, client config, and env validation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Tech decisions:**
- DEC-001: Use Agora.io (free tier)

**Current state:**
- Agora env vars in .env
- No SDK/token routes implemented

**Requirements:**
- Server-side token generation
- Secure access (authenticated users only)
- Support appointment-based channels
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Agora SDK + server token lib</name>
  <files>package.json, package-lock.json</files>
  <action>
Install Agora RTC SDK and token generator library.

Suggested:
- `agora-rtc-sdk-ng`
- `agora-token` (or official server token helper)
  </action>
  <verify>
Dependencies added to package.json.
  </verify>
  <done>
- Agora SDK deps installed
  </done>
</task>

<task type="auto">
  <name>Task 2: Create token API route</name>
  <files>src/app/api/agora/token/route.ts (new)</files>
  <action>
Create authenticated endpoint that:
- Validates session
- Accepts channel name + role (host/audience)
- Generates token with short TTL (e.g., 1 hour)
- Returns token + appId
  </action>
  <verify>
Endpoint returns token for authenticated users.
  </verify>
  <done>
- Secure token endpoint ready
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Agora SDK installed
- [ ] Token endpoint exists and requires auth
</verification>

<success_criteria>
- Token generation ready for client calls
</success_criteria>

<output>
After completion, create `.planning/phases/06-video-consultations/06-01-SUMMARY.md`
</output>
