---
phase: 02-authentication-system
plan: 03
type: execute
depends_on:
  - phase: 02-authentication-system
    plan: 02
files_modified: []
---

<objective>
Build a secure password reset flow using email tokens delivered via Resend.

Purpose: Allow users to reset forgotten passwords safely with short-lived, scoped tokens.

Output: Forgot-password and reset-password endpoints use secure tokens, expiry validation, and Resend email delivery.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@src/app/api/auth/forgot-password/route.ts
@src/app/api/auth/reset-password/route.ts
@src/app/(auth)/forgot-password/page.tsx
@src/app/(auth)/reset-password/page.tsx

**Requirements:**
- Use Resend for reset email
- Tokens must expire (30 minutes)
- Avoid user enumeration in responses
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update forgot-password token + email delivery</name>
  <files>
src/app/api/auth/forgot-password/route.ts
src/lib/tokens.ts
src/lib/email.ts
  </files>
  <action>
Generate reset tokens using the shared token helper with 30-minute expiry.

Send reset email via Resend (fallback to console).

Ensure responses remain generic to avoid user enumeration.
  </action>
  <verify>
- Reset tokens stored with expiry
- Email contains reset link
- API responds with generic success
  </verify>
  <done>
- Forgot-password flow sends secure reset emails
  </done>
</task>

<task type="auto">
  <name>Task 2: Harden reset-password verification</name>
  <files>src/app/api/auth/reset-password/route.ts</files>
  <action>
Validate token type, expiry, and presence before updating the password.

Delete tokens after use or when expired.
  </action>
  <verify>
- Invalid/expired tokens are rejected
- Password updates succeed with valid token
- Token removed after use
  </verify>
  <done>
- Reset-password endpoint handles tokens safely
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Password reset flow with Resend + secure tokens</what-built>
  <how-to-verify>
1. Request a reset for an existing email.
2. Confirm reset email (or console log) contains valid link.
3. Reset password with token.
4. Verify token cannot be reused.
  </how-to-verify>
  <resume-signal>Type "approved 02-03" once reset flow works end-to-end</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Reset email sent via Resend
- [ ] Token expiry enforced (30 min)
- [ ] Token invalid after use
</verification>

<success_criteria>
- Password reset is secure and fully functional
- Resend handles delivery (with console fallback)
- Reset flow protects against enumeration
</success_criteria>

<output>
After completion, create `.planning/phases/02-authentication-system/02-03-SUMMARY.md`
</output>
