---
phase: 05-email-notifications
plan: 04
type: execute
depends_on:
  - phase: 05-email-notifications
    plan: 02
  - phase: 05-email-notifications
    plan: 03
files_modified: []
---

<objective>
Add cancellation/reschedule notification triggers and finalize Phase 5 documentation.

Purpose: Keep patients and psychologists informed about changes to appointments.

Output: Appointment update endpoint with notification emails, summaries/state updated, and commit created.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/lib/appointment-emails.ts

**Requirements:**
- Notify both parties on cancellation or reschedule
- Secure endpoint with role checks
- Update roadmap/state + commit
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add appointment update endpoint with notifications</name>
  <files>src/app/api/appointments/[id]/route.ts (new)</files>
  <action>
Implement PATCH endpoint that allows patient/psychologist/admin to:
- Cancel appointment (status -> CANCELLED)
- Reschedule appointment (update start/end/date)

Send cancellation or reschedule emails using template helper.
  </action>
  <verify>
- Only authorized users can update
- Emails sent on cancel/reschedule
  </verify>
  <done>
- Appointment updates trigger email notifications
  </done>
</task>

<task type="auto">
  <name>Task 2: Update planning docs and commit</name>
  <files>
.planning/phases/05-email-notifications/05-04-SUMMARY.md
.planning/STATE.md
.planning/ROADMAP.md
  </files>
  <action>
- Write Phase 5 summary file
- Mark Phase 5 complete in ROADMAP
- Update STATE metrics and current focus
- Commit all Phase 5 changes
  </action>
  <verify>
- ROADMAP shows Phase 5 checked
- STATE updated to next phase
- Commit created
  </verify>
  <done>
- Phase 5 wrapped and committed
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Cancel/reschedule emails are implemented
- [ ] ROADMAP/STATE updated
- [ ] Commit created
</verification>

<success_criteria>
- Email notifications cover confirmations, reminders, cancellations, reschedules
- Phase 5 fully documented and committed
</success_criteria>

<output>
After completion, create `.planning/phases/05-email-notifications/05-04-SUMMARY.md`
</output>
