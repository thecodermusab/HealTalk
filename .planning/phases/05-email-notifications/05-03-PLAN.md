---
phase: 05-email-notifications
plan: 03
type: execute
depends_on:
  - phase: 05-email-notifications
    plan: 01
files_modified: []
---

<objective>
Implement reminder emails (24h and 1h before appointments).

Purpose: Reduce no-shows and keep both parties informed.

Output: Secure API endpoint to trigger reminders and mark them as sent.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@prisma/schema.prisma
@src/lib/appointment-emails.ts

**Requirements:**
- Send reminder at ~24h and ~1h before start
- Avoid duplicate sends (use reminder fields)
- Secure endpoint (optional CRON_SECRET)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reminder API endpoint</name>
  <files>src/app/api/notifications/appointments/reminders/route.ts (new)</files>
  <action>
Create a GET endpoint that:
- Verifies CRON_SECRET if set (header `x-cron-secret`)
- Finds upcoming appointments within the next 24h/1h
- Sends reminders to patient + psychologist
- Updates reminder timestamp fields

Support query param `window=24h|1h|all` (default all).
  </action>
  <verify>
- Endpoint returns counts for reminders sent
- Duplicate reminders prevented
  </verify>
  <done>
- Reminder endpoint ready for cron scheduling
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Reminder endpoint exists
- [ ] Uses reminder sent fields to avoid duplicates
- [ ] Requires secret if configured
</verification>

<success_criteria>
- Reminder emails can be triggered reliably
</success_criteria>

<output>
After completion, create `.planning/phases/05-email-notifications/05-03-SUMMARY.md`
</output>
