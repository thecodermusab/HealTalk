---
phase: 01-foundation-environment
plan: 01
type: execute
depends_on: []
files_modified: []
---

<objective>
Set up Neon PostgreSQL database with free tier and obtain connection string for production-ready serverless database.

Purpose: Establish the database foundation that all features depend on. Neon provides serverless PostgreSQL with generous free tier (0.5GB storage, autoscaling) and zero cold starts.

Output: Working Neon PostgreSQL database with connection string ready for .env configuration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@prisma/schema.prisma

**Tech decisions:**
- DEC-004: Use Neon PostgreSQL (free tier, serverless, Vercel integration)

**Current database:**
- Prisma schema exists with 15 models
- DATABASE_URL currently points to localhost (from .env.example)
- No production database configured yet

**Requirements:**
- Free tier (budget: $0/month)
- PostgreSQL compatible (Prisma requirement)
- Serverless (no connection pooling needed)
- Fast for Next.js serverless functions
</context>

<tasks>

<task type="checkpoint:decision" gate="blocking">
  <decision>Choose database hosting provider</decision>
  <context>We need a PostgreSQL database with a generous free tier for the MVP. Three excellent options:</context>
  <options>
    <option id="neon">
      <name>Neon (Recommended)</name>
      <pros>0.5GB free, serverless architecture, instant branching, Vercel integration, autoscaling, no cold starts</pros>
      <cons>Storage limit might be tight with user growth (but upgrading is $19/mo)</cons>
    </option>
    <option id="supabase">
      <name>Supabase</name>
      <pros>500MB free, includes auth/storage/realtime, PostgreSQL + extras, great DX</pros>
      <cons>Instance pauses after 7 days inactivity (not ideal for production)</cons>
    </option>
    <option id="railway">
      <name>Railway</name>
      <pros>$5 free credit monthly, persistent, easy CLI, includes Redis option</pros>
      <cons>Free credit runs out (need to reload monthly), less serverless-optimized</cons>
    </option>
  </options>
  <resume-signal>Select: neon, supabase, or railway</resume-signal>
</task>

<task type="auto">
  <name>Task 1: Create database and obtain connection string</name>
  <files>None (external service setup)</files>
  <action>
Using the selected provider from the decision above:

**If Neon selected:**
1. Visit neon.tech and sign up with GitHub account (simplest auth)
2. Create new project named "healtalk-production"
3. Select region closest to user base (e.g., AWS us-east-1 for US, eu-central-1 for Europe)
4. Database name: "psyconnect"
5. Copy the connection string - format: `postgresql://[user]:[password]@[host]/[db]?sslmode=require`
6. Note: Keep this secure - it contains credentials

**If Supabase selected:**
1. Visit supabase.com and sign up with GitHub
2. Create new project "healtalk-production"
3. Set strong database password (save to password manager)
4. Wait for provisioning (~2 minutes)
5. Go to Project Settings > Database
6. Copy "Connection string" (URI format, not Session mode)
7. Replace [YOUR-PASSWORD] placeholder with actual password

**If Railway selected:**
1. Install Railway CLI: `npm install -g @railway/cli`
2. Run `railway login` to authenticate
3. Run `railway init` to create project
4. Run `railway add` and select PostgreSQL
5. Run `railway variables` to see DATABASE_URL
6. Copy the connection string

**IMPORTANT:** Do NOT commit the connection string to git. Store securely for next plan.
  </action>
  <verify>
Connection string format is valid PostgreSQL URI:
- Starts with `postgresql://` or `postgres://`
- Contains username, password, host, port, database name
- Includes SSL mode parameter (for Neon/Supabase)

Test connection with a simple script (without committing credentials):
```bash
node -e "const { Client } = require('pg'); const client = new Client({ connectionString: 'YOUR_URL' }); client.connect().then(() => console.log('Connected!')).catch(e => console.error(e)).finally(() => client.end());"
```
  </verify>
  <done>
- Database created on chosen provider
- Connection string obtained and verified
- Connection test successful
- Credentials stored securely (NOT in git)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Production PostgreSQL database on selected provider</what-built>
  <how-to-verify>
1. Confirm you received the connection string (format: `postgresql://user:pass@host/db`)
2. Verify connection test passed (saw "Connected!" message)
3. Log into provider dashboard and confirm database is active:
   - **Neon:** Check dashboard shows project with "Active" status
   - **Supabase:** Table Editor loads (empty is fine)
   - **Railway:** Database shows in project with "Active" status
4. Note the connection string securely (will be used in Plan 01-03)
  </how-to-verify>
  <resume-signal>Type "approved [provider-name]" (e.g., "approved neon") to continue, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Database provider account created
- [ ] PostgreSQL database provisioned
- [ ] Connection string obtained and tested
- [ ] Database is accessible and active
- [ ] No credentials committed to git
</verification>

<success_criteria>

- Database provider selected and account created
- Production PostgreSQL database running
- Valid connection string obtained
- Connection verified working
- Database ready for Prisma migration
- Credentials stored securely for environment configuration
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-environment/01-01-SUMMARY.md`:

# Phase 1 Plan 1: Database Setup Summary

**Production PostgreSQL database provisioned on [provider] with verified connection**

## Accomplishments

- Created [Neon/Supabase/Railway] account
- Provisioned PostgreSQL database "healtalk-production"
- Obtained and tested connection string
- Verified database connectivity

## Files Created/Modified

None (external service setup only)

## Decisions Made

- Selected [provider] for PostgreSQL hosting
- Chose [region] for database location
- Database named "psyconnect" under project "healtalk-production"

## Service Details

- **Provider:** [Neon/Supabase/Railway]
- **Database:** psyconnect
- **Region:** [selected region]
- **Free tier limits:** [provider-specific limits]
- **Connection string:** Secured (not in git)

## Issues Encountered

[Any setup issues or none]

## Next Step

Ready for 01-02-PLAN.md - Service account creation (Agora, Resend, Uploadthing, Stripe, Sentry)
</output>
