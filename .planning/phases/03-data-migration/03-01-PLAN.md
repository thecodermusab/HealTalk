---
phase: 03-data-migration
plan: 01
type: execute
depends_on: []
files_modified: [prisma/seeds/psychologists.ts, prisma/seeds/hospitals.ts]
---

<objective>
Create database seeding scripts to migrate psychologist and hospital mock data from TypeScript files into PostgreSQL database.

Purpose: Replace static mock data with real database records that can be queried, filtered, and updated through API routes.

Output: Seeding scripts that populate Psychologist and Hospital tables with all mock data, ready for API consumption.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-environment/01-04-SUMMARY.md
@prisma/schema.prisma
@src/lib/mock-data.ts

**Prerequisites:**
- Database running with 15 models (from Phase 1)
- Seed script infrastructure exists (prisma/seed.ts from Phase 1)
- Psychologist model has: credentials, licenseNumber, experience, bio, specializations, price60, price90, rating, reviewCount, status, hospitalId

**Current mock data:**
- 759 lines in mock-data.ts
- ~20+ psychologists with full profiles
- Hospital references need to be mapped
- Need to transform mock structure to match Prisma schema

**Key decisions affecting this plan:**
- Phase 1: Database uses Neon PostgreSQL (serverless)
- Phase 1: Prisma ORM with 15 models already migrated
- Bootstrap users already exist (3 users from seed.ts)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create hospitals seeding data</name>
  <files>prisma/seeds/hospitals.ts</files>
  <action>
Create `prisma/seeds/hospitals.ts` that exports an array of hospital data to seed.

Extract unique hospitals from mock-data.ts psychologist locations:
- Acıbadem Hospital (Istanbul) - already exists from Phase 1
- Memorial Hospital (Istanbul) - already exists from Phase 1
- Add 3-5 more hospitals for US/international psychologists

Structure:
```typescript
export const hospitalSeedData = [
  { name: "Acıbadem Hospital", location: "Istanbul", address: "Teşvikiye Mahallesi..." },
  { name: "NewYork-Presbyterian", location: "New York, United States", address: "..." },
  // ... more hospitals
];
```

Important:
- Use actual hospital names from psychologist locations in mock data
- Provide realistic addresses
- Keep status as "active" by default
- This file will be imported by main seed.ts
  </action>
  <verify>
```bash
# File exists and exports data
cat prisma/seeds/hospitals.ts | grep "export const hospitalSeedData"

# Valid TypeScript
npx tsc --noEmit prisma/seeds/hospitals.ts
```
  </verify>
  <done>
- prisma/seeds/hospitals.ts created
- Exports hospitalSeedData array
- Contains 5-8 hospitals with name, location, address
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create psychologists seeding data</name>
  <files>prisma/seeds/psychologists.ts</files>
  <action>
Create `prisma/seeds/psychologists.ts` that transforms mock psychologist data to match Prisma schema.

Map from mock-data.ts Psychologist interface to Prisma Psychologist model:
- Mock `id` → ignore (Prisma generates cuid)
- Mock `name` → User.name
- Mock `title` → credentials field
- Mock `priceRange` "$150 - $250" → parse to price60/price90 in cents (15000, 25000)
- Mock `conditions` → specializations array
- Mock `experience` → experience (number)
- Mock `about` → bio (text)
- Mock `rating` → rating (float)
- Mock `reviewCount` → reviewCount (int)
- Mock `licenseNumber` → licenseNumber
- Mock `location` → map to hospitalId (match hospital.location)

Create structure:
```typescript
export const psychologistSeedData = [
  {
    user: { name: "Dr. Sarah Thompson", email: "sarah.thompson@example.com" },
    credentials: "Clinical Psychologist, PhD",
    licenseNumber: "PSY-NY-12345",
    experience: 10,
    bio: "...",
    specializations: ["Anxiety", "Depression", "Trauma"],
    price60: 15000, // $150 in cents
    price90: 25000, // $250 in cents
    rating: 4.9,
    reviewCount: 124,
    status: "APPROVED",
    hospitalName: "NewYork-Presbyterian" // Will be resolved to ID
  },
  // ... transform all ~20 psychologists
];
```

Important:
- Convert ALL psychologists from mock-data.ts
- Prices in cents (multiply by 100)
- status: "APPROVED" (so they appear in listings)
- approvedAt: new Date()
- Generate unique emails: firstname.lastname@example.com
- Don't include password (OAuth/registration only)
  </action>
  <verify>
```bash
# File exists and exports data
cat prisma/seeds/psychologists.ts | grep "export const psychologistSeedData"

# Valid TypeScript
npx tsc --noEmit prisma/seeds/psychologists.ts

# Count psychologists (should be ~20+)
node -e "const {psychologistSeedData} = require('./prisma/seeds/psychologists.ts'); console.log('Psychologists:', psychologistSeedData.length);"
```
  </verify>
  <done>
- prisma/seeds/psychologists.ts created
- Exports psychologistSeedData array
- Contains 20+ psychologists with all required fields
- Prices converted to cents
- All psychologists have status: "APPROVED"
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Update main seed script to use new data</name>
  <files>prisma/seed.ts</files>
  <action>
Update `prisma/seed.ts` to import and seed hospitals and psychologists from the new seed data files.

Add after bootstrap users section:

```typescript
import { hospitalSeedData } from './seeds/hospitals';
import { psychologistSeedData } from './seeds/psychologists';

console.log('Seeding hospitals...');
const hospitalMap = new Map();
for (const h of hospitalSeedData) {
  const hospital = await prisma.hospital.upsert({
    where: { name: h.name },
    update: {},
    create: h
  });
  hospitalMap.set(h.name, hospital.id);
  console.log(`  ✓ ${h.name}`);
}

console.log('Seeding psychologists...');
for (const p of psychologistSeedData) {
  const hospitalId = hospitalMap.get(p.hospitalName);

  const user = await prisma.user.create({
    data: {
      name: p.user.name,
      email: p.user.email,
      role: 'PSYCHOLOGIST',
      emailVerified: new Date(),
      psychologist: {
        create: {
          credentials: p.credentials,
          licenseNumber: p.licenseNumber,
          experience: p.experience,
          bio: p.bio,
          specializations: p.specializations,
          price60: p.price60,
          price90: p.price90,
          rating: p.rating,
          reviewCount: p.reviewCount,
          status: p.status,
          approvedAt: new Date(),
          hospitalId: hospitalId
        }
      }
    }
  });
  console.log(`  ✓ ${p.user.name}`);
}

console.log('✓ Database seeded successfully!');
```

Important:
- Use upsert for hospitals (idempotent)
- Create fresh User + Psychologist records
- Map hospitalName to hospitalId using hospitalMap
- Log progress for each record
- Handle missing hospital gracefully (hospitalId can be null)
  </action>
  <verify>
```bash
# Seed script compiles
npx tsc --noEmit prisma/seed.ts

# Run seed (should not error)
npm run db:seed

# Verify psychologists created
node -e "const { PrismaClient } = require('@prisma/client'); const prisma = new PrismaClient(); prisma.psychologist.count().then(c => console.log('Total psychologists:', c)).finally(() => prisma.\$disconnect());"

# Should show 20+ psychologists (3 bootstrap + new ones)
```
  </verify>
  <done>
- prisma/seed.ts updated with hospital and psychologist seeding
- Imports from ./seeds/hospitals and ./seeds/psychologists
- npm run db:seed completes without errors
- Database has 20+ psychologists with APPROVED status
- All psychologists linked to hospitals where applicable
- Idempotent (safe to re-run)
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] prisma/seeds/hospitals.ts exists and exports hospitalSeedData
- [ ] prisma/seeds/psychologists.ts exists and exports psychologistSeedData
- [ ] prisma/seed.ts imports and uses both seed data files
- [ ] npm run db:seed runs without errors
- [ ] Database has 5-8 hospitals
- [ ] Database has 20+ approved psychologists
- [ ] All psychologists have user accounts with unique emails
- [ ] Prices stored in cents (price60, price90)
</verification>

<success_criteria>

- Seeding infrastructure created for hospitals and psychologists
- All mock psychologist data migrated to database format
- Seed script successfully populates database
- Data matches Prisma schema structure
- Ready for API routes to query real data
</success_criteria>

<output>
After completion, create `.planning/phases/03-data-migration/03-01-SUMMARY.md`:

# Phase 3 Plan 1: Psychologist & Hospital Seeding Summary

**Database seeding scripts created and populated with 20+ psychologists and hospitals**

## Accomplishments

- Created prisma/seeds/hospitals.ts with hospital seed data
- Created prisma/seeds/psychologists.ts with transformed psychologist data
- Updated prisma/seed.ts to import and seed both datasets
- Successfully populated database with real psychologist profiles
- All psychologists marked as APPROVED and linked to hospitals

## Files Created/Modified

- `prisma/seeds/hospitals.ts` - Hospital seed data (5-8 hospitals)
- `prisma/seeds/psychologists.ts` - Psychologist seed data (20+ profiles)
- `prisma/seed.ts` - Updated main seed script

## Data Transformation

**Mock to Database mapping:**
- priceRange "$150 - $250" → price60: 15000, price90: 25000 (cents)
- conditions array → specializations array
- Mock IDs discarded (Prisma generates cuids)
- Unique emails generated for each psychologist
- All set to status: "APPROVED" for immediate visibility

## Decisions Made

- Used upsert for hospitals (idempotent seeding)
- Generated example.com emails for psychologists
- Linked psychologists to hospitals via location matching
- All psychologists auto-approved (no manual workflow for seeded data)

## Issues Encountered

[Any issues or "None"]

## Next Step

Ready for **03-02-PLAN.md** - Update psychologist listing and profile pages to fetch from database API
</output>
