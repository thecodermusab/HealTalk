---
phase: 10-security-hardening
plan: 02
type: execute
depends_on:
  - phase: 10-security-hardening
    plan: 01
files_modified: []
---

<objective>
Implement rate limiting for authentication and high-traffic API routes.

Purpose: Protect against abuse, brute-force attacks, and accidental overload.

Output: Rate limiting middleware or per-route guards with safe defaults.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/app/api

**Requirements:**
- Free-tier compatible solution (Upstash recommended)
- Apply to auth routes and key API endpoints
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add rate limiting utility</name>
  <files>package.json, package-lock.json, src/lib/rate-limit.ts (new)</files>
  <action>
Install a rate limiting library (e.g., `@upstash/ratelimit` + `@upstash/redis`) and create a helper to apply per-route limits with graceful fallback when env is missing.
  </action>
  <verify>
Helper returns 429 when limits exceeded.
  </verify>
  <done>
- Rate limiter helper created
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply limits to auth routes</name>
  <files>
src/app/api/auth/register/route.ts
src/app/api/auth/forgot-password/route.ts
src/app/api/auth/reset-password/route.ts
src/app/api/auth/verify-email/route.ts
  </files>
  <action>
Apply strict rate limits to authentication-related endpoints.
  </action>
  <verify>
Repeated requests return 429.
  </verify>
  <done>
- Auth endpoints rate-limited
  </done>
</task>

<task type="auto">
  <name>Task 3: Apply limits to admin + messaging routes</name>
  <files>
src/app/api/admin/**/route.ts
src/app/api/messages/[appointmentId]/route.ts
src/app/api/appointments/route.ts
  </files>
  <action>
Apply moderate rate limits to admin and messaging endpoints.
  </action>
  <verify>
Rate limits enforced without breaking normal use.
  </verify>
  <done>
- Admin/messaging routes rate-limited
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Rate limiter helper exists
- [ ] Auth routes limited
- [ ] Admin + messaging routes limited
</verification>

<success_criteria>
- Sensitive endpoints respond with 429 on abuse
</success_criteria>

<output>
After completion, create `.planning/phases/10-security-hardening/10-02-SUMMARY.md`
</output>
