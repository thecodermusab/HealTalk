---
phase: 10-security-hardening
plan: 01
type: execute
depends_on:
  - phase: 09-admin-panel
    plan: 04
files_modified: []
---

<objective>
Add Zod validation to all API routes for request bodies and key query parameters.

Purpose: Prevent invalid or malicious inputs from reaching business logic.

Output: API routes validated with shared Zod schemas and consistent 400 responses.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@package.json
@src/app/api

**Requirements:**
- Add Zod dependency
- Validate POST/PATCH bodies and important query params
- Return consistent 400 errors when validation fails
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Zod dependency + shared helpers</name>
  <files>package.json, package-lock.json, src/lib/validation.ts (new)</files>
  <action>
Install `zod` and create helper utilities for parsing JSON bodies and query params.
  </action>
  <verify>
Zod installed and helper exported for reuse.
  </verify>
  <done>
- Zod available in project
- Shared validation helpers created
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate auth + user routes</name>
  <files>
src/app/api/auth/register/route.ts
src/app/api/auth/forgot-password/route.ts
src/app/api/auth/reset-password/route.ts
src/app/api/auth/verify-email/route.ts
src/app/api/user/me/route.ts
  </files>
  <action>
Add Zod schemas for body and query payloads, returning 400 on invalid input.
  </action>
  <verify>
Invalid inputs return 400 with clear error message.
  </verify>
  <done>
- Auth/user routes validated
  </done>
</task>

<task type="auto">
  <name>Task 3: Validate appointments + messaging routes</name>
  <files>
src/app/api/appointments/route.ts
src/app/api/appointments/[id]/route.ts
src/app/api/messages/[appointmentId]/route.ts
src/app/api/messages/unread/route.ts
src/app/api/agora/token/route.ts
  </files>
  <action>
Add Zod validation for request bodies and critical params.
  </action>
  <verify>
Invalid inputs return 400.
  </verify>
  <done>
- Appointment/messaging routes validated
  </done>
</task>

<task type="auto">
  <name>Task 4: Validate admin + content routes</name>
  <files>
src/app/api/admin/**/route.ts
src/app/api/psychologists/route.ts
src/app/api/psychologists/[id]/route.ts
src/app/api/blog/route.ts
src/app/api/blog/[id]/route.ts
src/app/api/guides/route.ts
src/app/api/podcasts/route.ts
  </files>
  <action>
Add Zod validation for admin query params and content endpoints.
  </action>
  <verify>
Admin/content routes reject invalid query payloads.
  </verify>
  <done>
- Admin/content routes validated
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Zod installed and helper available
- [ ] Auth routes validated
- [ ] Appointment/messaging routes validated
- [ ] Admin/content routes validated
</verification>

<success_criteria>
- All API routes perform Zod validation and return 400 on invalid inputs
</success_criteria>

<output>
After completion, create `.planning/phases/10-security-hardening/10-01-SUMMARY.md`
</output>
