---
phase: 10-security-hardening
plan: 05
type: execute
depends_on:
  - phase: 10-security-hardening
    plan: 04
files_modified: []
---

<objective>
Add audit logging for sensitive operations (auth, admin actions, payments).

Purpose: Provide traceability for security-sensitive events.

Output: AuditLog model + logging utility + instrumentation on key actions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@prisma/schema.prisma
@src/app/api

**Requirements:**
- Log admin actions and auth events
- Store logs in database with timestamps and actor
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add AuditLog model</name>
  <files>prisma/schema.prisma</files>
  <action>
Add an AuditLog model with actorId, action, targetType, targetId, metadata, and createdAt. Run migration.
  </action>
  <verify>
Migration applies successfully.
  </verify>
  <done>
- AuditLog model created
  </done>
</task>

<task type="auto">
  <name>Task 2: Add logging utility + instrument admin routes</name>
  <files>src/lib/audit.ts (new), src/app/api/admin/**/route.ts</files>
  <action>
Create a helper to write audit logs and call it from admin update/delete routes.
  </action>
  <verify>
Audit logs written for admin actions.
  </verify>
  <done>
- Admin actions logged
  </done>
</task>

<task type="auto">
  <name>Task 3: Log auth + payment events</name>
  <files>src/app/api/auth/**/route.ts, src/app/api/appointments/[id]/route.ts</files>
  <action>
Log sign-in attempts, password resets, and payment updates (when implemented).
  </action>
  <verify>
Audit logs created for key auth/payment events.
  </verify>
  <done>
- Auth/payment events logged
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] AuditLog model exists
- [ ] Admin actions logged
- [ ] Auth/payment events logged
</verification>

<success_criteria>
- Sensitive events are recorded with actor and timestamp
</success_criteria>

<output>
After completion, create `.planning/phases/10-security-hardening/10-05-SUMMARY.md`
</output>
