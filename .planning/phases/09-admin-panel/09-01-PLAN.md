---
phase: 09-admin-panel
plan: 01
type: execute
depends_on:
  - phase: 08-payment-processing
    plan: 05
files_modified: []
---

<objective>
Build the psychologist approval workflow so admins can review credentials, approve or reject applicants, and manage status changes.

Purpose: Enable safe onboarding of psychologists and provide a clear admin review flow.

Output: Admin UI + API routes for listing applicants and updating approval status.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@prisma/schema.prisma
@src/app/(dashboard)/admin/dashboard/psychologists/page.tsx
@src/app/api/uploads/credential/route.ts
@src/components/dashboard/DashboardLayout.tsx

**Current state:**
- Admin psychologists page is a placeholder
- Psychologist model has status (PENDING/APPROVED/SUSPENDED) and approvedAt
- Credential documents are stored via Uploadthing
- Admin can request signed credential URLs via `/api/uploads/credential?psychologistId=...`

**Requirements:**
- Admin-only access
- Approve, reject, and suspend workflows
- Display credential document for verification
- Persist status changes in DB
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend psychologist status handling</name>
  <files>prisma/schema.prisma</files>
  <action>
Add a rejection state to the psychologist approval lifecycle.

Suggested changes:
- Add `REJECTED` to `PsychologistStatus`
- Optional: add `rejectedAt` and `rejectionReason` fields (nullable) for audit/history

Run a Prisma migration after schema updates.
  </action>
  <verify>
- Prisma schema validates
- Migration applies successfully
- Existing queries still work with the updated enum
  </verify>
  <done>
- Psychologist status supports rejection
- Migration completed
  </done>
</task>

<task type="auto">
  <name>Task 2: Build admin psychologist API routes</name>
  <files>
src/app/api/admin/psychologists/route.ts (new)
src/app/api/admin/psychologists/[id]/route.ts (new)
  </files>
  <action>
Create admin-only endpoints:

- `GET /api/admin/psychologists` with filters: status, search, pagination
- `PATCH /api/admin/psychologists/[id]` to update status and set approvedAt/rejectedAt

Include key fields (name, email, licenseNumber, specializations, status, createdAt, credentialDocumentUrl).
  </action>
  <verify>
- Endpoints reject non-admin users
- Status updates persist in DB
- Filters/pagination work
  </verify>
  <done>
- Admin API routes available for approval workflow
  </done>
</task>

<task type="auto">
  <name>Task 3: Replace admin psychologists placeholder UI</name>
  <files>src/app/(dashboard)/admin/dashboard/psychologists/page.tsx</files>
  <action>
Build a management table with:
- Tabs or filters (Pending, Approved, Rejected, Suspended)
- Search by name/email/license
- Status badges + action buttons (Approve, Reject, Suspend)
- Credential document link (fetch signed URL from `/api/uploads/credential`)

Add loading/empty states and confirmation prompts for destructive actions.
  </action>
  <verify>
- Admin can view pending applicants
- Approve/reject updates status instantly
- Credential document opens securely
  </verify>
  <done>
- Psychologist approval workflow operational in admin UI
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Psychologist status includes REJECTED (and optional metadata)
- [ ] Admin API routes for list/update work
- [ ] Admin psychologists UI shows applicants and supports status changes
- [ ] Credential document view works via signed URL
</verification>

<success_criteria>
- Admin can approve, reject, or suspend psychologist applications
- Status changes are persisted and visible in the UI
</success_criteria>

<output>
After completion, create `.planning/phases/09-admin-panel/09-01-SUMMARY.md`
</output>
